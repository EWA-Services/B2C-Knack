requests_check=function(t,a,e,s,n,d){var y=new Date(a.split("/")[2],a.split("/")[1]-1,a.split("/")[0]),l=new Date(t.split("/")[2],t.split("/")[1]-1,t.split("/")[0]),o=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate());if(l<=o&&y>=o)a=d,y=new Date(d.split("/")[2],d.split("/")[1]-1,d.split("/")[0]);var i=!("-"==t||"-"==a),p=y;p.setDate(p.getDate()-n);var r=o>=p&&o<=l,_=(p.getDate()<10?"0"+p.getDate():p.getDate())+"/"+(p.getMonth()<9?"0":"")+(p.getMonth()+1)+"/"+p.getFullYear(),c={};$("#view_52 .kn-report-content table tbody tr").each(function(){var t=$(this).find(".kn-pivot-group").text().trim(),a=parseInt($(this).find(".kn-pivot-calc:eq(1)").text().trim());c[t]=a});var f=0;for(var u of Object.keys(c))if(new Date(2022,u.split("/")[1]-1,u.split("/")[0])<=new Date(a.split("/")[2],a.split("/")[1]-1,a.split("/")[0])&&new Date(2022,u.split("/")[1]-1,u.split("/")[0])>new Date(last_payday.split("/")[2],last_payday.split("/")[1]-1,last_payday.split("/")[0]))f=f+c[u];var g=e<=0||f<e,v={};$("#view_146 table tbody tr").each(function(){var t=$(this).find(".kn-pivot-group span").attr("class"),a=parseInt($(this).find(".kn-pivot-calc").text().trim());v[t]=a});var h=0==v["collection-failed"]&&0==v["collection-failed-re"]&&0==v["not-paid"]&&0==v["partially-paid"],w=0!=s;return r&&g&&h&&w&&i?{status:!0}:0==w?{status:!1,error:"Advances are not allowed at the moment."}:0==h?{status:!1,error:"Please pay back the advance you have received to be able to submit a new request."}:0==i?{status:!1,error:"Next payday is not defined. Please contact EWA support"}:0==r?{status:!1,error:"Salary advances are only available starting "+n+" days before your next payday. <span>You can withdraw again starting from "+_+"</span>"}:0==g?{status:!1,error:"You have reached the maximum number of advance requests for this month. You can request a new advance after you received your next salary."}:void 0};var cutoff_day=new Date(2025,0,1),payday=new Date(2025,0,1),last_payday=new Date(2020,0,1),last_cutoff_day=new Date(2020,0,1),months=$("#view_96 .kn-table tbody td.field_88 span"),paydays=$("#view_96 .kn-table tbody td.field_76 span"),cutoffs=$("#view_96 .kn-table tbody td.field_82 span");if($.each(months,function(t,a){var e=new Date(paydays[t].textContent.trim().split("/")[2],paydays[t].textContent.trim().split("/")[1]-1,paydays[t].textContent.trim().split("/")[0]),s=new Date(cutoffs[t].textContent.trim().split("/")[2],cutoffs[t].textContent.trim().split("/")[1]-1,cutoffs[t].textContent.trim().split("/")[0]);e>=new Date&&e<=payday?(payday=e||"-",cutoff_day=s||"-"):e<=new Date&&e>=last_payday&&(last_payday=e||"-",last_cutoff_day=s||"-")}),+payday==+new Date(2025,0,1))var next_payday="-";else{next_payday=new Date(2025,0,1);if($.each(months,function(t,a){var e=new Date(paydays[t].textContent.trim().split("/")[2],paydays[t].textContent.trim().split("/")[1]-1,paydays[t].textContent.trim().split("/")[0]);e>payday&&e<=next_payday&&(next_payday=e||"-")}),+next_payday==+new Date(2025,0,1))next_payday="-";else next_payday=(next_payday.getDate()<10?"0"+next_payday.getDate():next_payday.getDate())+"/"+(next_payday.getMonth()<9?"0"+(next_payday.getMonth()+1):next_payday.getMonth()+1)+"/"+next_payday.getFullYear()}if(+payday==+new Date(2025,0,1))payday="-",last_payday="-";else{if(+last_payday==+new Date(2020,0,1)){var last_payday_tmp=new Date(payday.getFullYear(),payday.getMonth(),payday.getDate());last_payday=new Date(last_payday_tmp.setMonth(last_payday_tmp.getMonth()-1))}payday=(payday.getDate()<10?"0"+payday.getDate():payday.getDate())+"/"+(payday.getMonth()<9?"0"+(payday.getMonth()+1):payday.getMonth()+1)+"/"+payday.getFullYear()}if(+cutoff_day==+new Date(2025,0,1))cutoff_day="-",last_cutoff_day="-";else{if(+last_cutoff_day==+new Date(2020,0,1)){var last_cutoff_day_tmp=new Date(cutoff_day.getFullYear(),cutoff_day.getMonth(),cutoff_day.getDate());last_cutoff_day=new Date(last_cutoff_day_tmp.setMonth(last_cutoff_day_tmp.getMonth()-1))}cutoff_day=(cutoff_day.getDate()<10?"0"+cutoff_day.getDate():cutoff_day.getDate())+"/"+(cutoff_day.getMonth()<9?"0"+(cutoff_day.getMonth()+1):cutoff_day.getMonth()+1)+"/"+cutoff_day.getFullYear()}if("-"!=last_payday)last_payday=(last_payday.getDate()<10?"0"+last_payday.getDate():last_payday.getDate())+"/"+(last_payday.getMonth()<9?"0"+(last_payday.getMonth()+1):last_payday.getMonth()+1)+"/"+last_payday.getFullYear();if("-"!=last_cutoff_day)last_cutoff_day=(last_cutoff_day.getDate()<10?"0"+last_cutoff_day.getDate():last_cutoff_day.getDate())+"/"+(last_cutoff_day.getMonth()<9?"0"+(last_cutoff_day.getMonth()+1):last_cutoff_day.getMonth()+1)+"/"+last_cutoff_day.getFullYear();$("head").append('<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">');var ionic_user_id=$("#view_158 .field_150 span span").text(),paydays_url=encodeURI("http://128.199.123.115/api/staging_knack/users/next-paydays/"+ionic_user_id);$.ajax({url:paydays_url,type:"GET",headers:{Authorization:"528bA7490d7f4c056b0hAde4"},success:function(t){console.log("Payday Received !"),console.log(t)}});var base_salary=parseFloat(""==$("#view_51 .field_44 .kn-detail-body").text().replace(/,/g,"")?0:$("#view_51 .field_44 .kn-detail-body").text().replace(/,/g,"")),requested_amount=parseFloat(""==$("#view_52 .kn-pivot-calc:eq(0)").text().replace(/,/g,"")?0:$("#view_52 .kn-pivot-calc:eq(0)").text().replace(/,/g,"")),max_number_requests=parseFloat(""==$("#view_68 .field_91 .kn-detail-body").text().replace(/,/g,"")?0:$("#view_68 .field_91 .kn-detail-body").text().replace(/,/g,"")),withdrawable_threshold=parseFloat(""==$("#view_68 .field_89 .kn-detail-body").text().replace(/,/g,"")?0:$("#view_68 .field_89 .kn-detail-body").text().replace(/,/g,"")),max_per_request=parseFloat(""==$("#view_51 .kn-detail.field_105 .kn-detail-body span span").text().replace(/,/g,"")?0:$("#view_51 .kn-detail.field_105 .kn-detail-body span span").text().replace(/,/g,"")),days_to_request=parseInt(""==$("#view_51 .kn-detail.field_149 .kn-detail-body span span").text().replace(/,/g,"")?0:$("#view_51 .kn-detail.field_149 .kn-detail-body span span").text().replace(/,/g,"")),current_date=new Date,mtd=current_date.getDate()-1,tot=new Date(current_date.getFullYear(),current_date.getMonth()+1,0).getDate(),balance=base_salary*mtd/tot,available_amount=balance-requested_amount,check=requests_check(cutoff_day,payday,max_number_requests,max_per_request,days_to_request,next_payday),html='<section id="custom-view-scene1"><div class="payday-wrapper"><div><div class="payday-label">Next Payday</div><div class="payday-value">'+payday+'</div><span class="cutoff-message"><i>Cut-off at '+cutoff_day+'</i></span></div><img src="https://root.ewa-services.com/ewa/images/ico-calendar.svg"/></div><div class="max-withdrawable"><div class="max-withdrawable-label">Maximum Withdrawable Amount</div><div class="max-amount-button"><span>'+(!0===check.status?(Math.round(100*max_per_request)/100).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):0)+"</span><a"+(!0===check.status?' href="'+window.location.pathname+'#request"':' style="pointer-events:none;" class="disabled"')+">Withdraw</a></div>"+(!0===check.status?"":"<p class='error-message'>"+check.error+"</p>")+"</div></section>";$(html).insertBefore($("#kn-scene_1"));