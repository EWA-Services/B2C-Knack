requests_check=function(d,b,j,s,k,e){var h=new Date(b.split("/")[2],b.split("/")[1]-1,b.split("/")[0]),l=new Date(d.split("/")[2],d.split("/")[1]-1,d.split("/")[0]),f=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate());if(l<=f&&h>=f)var b=e,h=new Date(e.split("/")[2],e.split("/")[1]-1,e.split("/")[0]);var m=!("-"==d||"-"==b),a=h;a.setDate(a.getDate()-k);var n=f>=a&&f<=l,t=(10>a.getDate()?"0"+a.getDate():a.getDate())+"/"+(9>a.getMonth()?"0":"")+(a.getMonth()+1)+"/"+a.getFullYear(),o={};$("#view_52 .kn-report-content table tbody tr").each(function(){var a=$(this).find(".kn-pivot-group").text().trim(),b=parseInt($(this).find(".kn-pivot-calc:eq(1)").text().trim());o[a]=b});var i=0;for(var c of Object.keys(o))if(new Date(2022,c.split("/")[1]-1,c.split("/")[0])<=new Date(b.split("/")[2],b.split("/")[1]-1,b.split("/")[0])&&new Date(2022,c.split("/")[1]-1,c.split("/")[0])>new Date(last_payday.split("/")[2],last_payday.split("/")[1]-1,last_payday.split("/")[0]))var i=i+o[c];var p=j<=0||i<j,g={};$("#view_146 table tbody tr").each(function(){var a=$(this).find(".kn-pivot-group span").attr("class"),b=parseInt($(this).find(".kn-pivot-calc").text().trim());g[a]=b});var q=0==g["collection-failed"]&&0==g["collection-failed-re"]&&0==g["not-paid"]&&0==g["partially-paid"],r=0!=s;return n&&p&&q&&r&&m?{status:!0}:!1==r?{status:!1,error:"Advances are not allowed at the moment."}:!1==q?{status:!1,error:"Please pay back the advance you have received to be able to submit a new request."}:!1==m?{status:!1,error:"Next payday is not defined. Please contact EWA support"}:!1==n?{status:!1,error:"Salary advances are only available starting "+k+" days before your next payday. <span>You can withdraw again starting from "+t+"</span>"}:!1==p?{status:!1,error:"You have reached the maximum number of advance requests for this month. You can request a new advance after you received your next salary."}:void 0};var cutoff_day=new Date(2025,0,1),payday=new Date(2025,0,1),last_payday=new Date(2020,0,1),last_cutoff_day=new Date(2020,0,1),months=$("#view_96 .kn-table tbody td.field_88 span"),paydays=$("#view_96 .kn-table tbody td.field_76 span"),cutoffs=$("#view_96 .kn-table tbody td.field_82 span");if($.each(months,function(a,d){var b=new Date(paydays[a].textContent.trim().split("/")[2],paydays[a].textContent.trim().split("/")[1]-1,paydays[a].textContent.trim().split("/")[0]),c=new Date(cutoffs[a].textContent.trim().split("/")[2],cutoffs[a].textContent.trim().split("/")[1]-1,cutoffs[a].textContent.trim().split("/")[0]);b>=new Date&&b<=payday?(payday=b||"-",cutoff_day=c||"-"):b<=new Date&&b>=last_payday&&(last_payday=b||"-",last_cutoff_day=c||"-")}),+payday== +new Date(2025,0,1))var next_payday="-";else{var next_payday=new Date(2025,0,1);if($.each(months,function(a,c){var b=new Date(paydays[a].textContent.trim().split("/")[2],paydays[a].textContent.trim().split("/")[1]-1,paydays[a].textContent.trim().split("/")[0]);b>payday&&b<=next_payday&&(next_payday=b||"-")}),+next_payday== +new Date(2025,0,1))var next_payday="-";else var next_payday=(10>next_payday.getDate()?"0"+next_payday.getDate():next_payday.getDate())+"/"+(9>next_payday.getMonth()?"0"+(next_payday.getMonth()+1):next_payday.getMonth()+1)+"/"+next_payday.getFullYear()}if(+payday== +new Date(2025,0,1))var payday="-",last_payday="-";else{if(+last_payday== +new Date(2020,0,1))var a=new Date(payday.getFullYear(),payday.getMonth(),payday.getDate()),last_payday=new Date(a.setMonth(a.getMonth()-1));var payday=(10>payday.getDate()?"0"+payday.getDate():payday.getDate())+"/"+(9>payday.getMonth()?"0"+(payday.getMonth()+1):payday.getMonth()+1)+"/"+payday.getFullYear()}if(+cutoff_day== +new Date(2025,0,1))var cutoff_day="-",last_cutoff_day="-";else{if(+last_cutoff_day== +new Date(2020,0,1))var b=new Date(cutoff_day.getFullYear(),cutoff_day.getMonth(),cutoff_day.getDate()),last_cutoff_day=new Date(b.setMonth(b.getMonth()-1));var cutoff_day=(10>cutoff_day.getDate()?"0"+cutoff_day.getDate():cutoff_day.getDate())+"/"+(9>cutoff_day.getMonth()?"0"+(cutoff_day.getMonth()+1):cutoff_day.getMonth()+1)+"/"+cutoff_day.getFullYear()}if("-"!=last_payday)var last_payday=(10>last_payday.getDate()?"0"+last_payday.getDate():last_payday.getDate())+"/"+(9>last_payday.getMonth()?"0"+(last_payday.getMonth()+1):last_payday.getMonth()+1)+"/"+last_payday.getFullYear();if("-"!=last_cutoff_day)var last_cutoff_day=(10>last_cutoff_day.getDate()?"0"+last_cutoff_day.getDate():last_cutoff_day.getDate())+"/"+(9>last_cutoff_day.getMonth()?"0"+(last_cutoff_day.getMonth()+1):last_cutoff_day.getMonth()+1)+"/"+last_cutoff_day.getFullYear();var ionic_user_id=$("#view_158 .field_150 span span").text(),payday_mode=$("#view_158 .field_167 span span").text(),cutoff_days_param=parseInt($("#view_51 .field_169 .kn-detail-body").text());if("API"==payday_mode.toUpperCase().trim()){var c,d="https://script.google.com/macros/s/AKfycbxjUcslqN__FunFgq7z3DfkTY6HR3xJaQOLkoyP9DsQU403LbeWpaIVoDOv1omX-z7X/exec";if($.ajax({url:d,type:"POST",async:!1,dataType:"json",data:JSON.stringify({apiPath:"requestNextPayday",apiKey:"nYJPMrwQxkNcF_88h4@n",ionicId:ionic_user_id}),success:function(a){console.log("success"),c=a},error:function(b,c,a){console.log("error"),console.log(a)}}),!0==c.success){var payday=c.nextPaydayOptions[0],cutoff_day=new Date(payday),cutoff_day=cutoff_day.setDate(cutoff_day.getDate()-cutoff_days_param);console.log(cutoff_day);var payday=payday.split("-")[2]+"/"+payday.split("-")[1]+"/"+payday.split("-")[0],cutoff_day=(10>cutoff_day.getDate()?"0"+cutoff_day.getDate():cutoff_day.getDate())+"/"+(9>cutoff_day.getMonth()?"0":"")+(cutoff_day.getMonth()+1)+"/"+cutoff_day.getFullYear()}}var base_salary=parseFloat(""==$("#view_51 .field_44 .kn-detail-body").text().replace(/,/g,"")?0:$("#view_51 .field_44 .kn-detail-body").text().replace(/,/g,"")),requested_amount=parseFloat(""==$("#view_52 .kn-pivot-calc:eq(0)").text().replace(/,/g,"")?0:$("#view_52 .kn-pivot-calc:eq(0)").text().replace(/,/g,"")),max_number_requests=parseFloat(""==$("#view_68 .field_91 .kn-detail-body").text().replace(/,/g,"")?0:$("#view_68 .field_91 .kn-detail-body").text().replace(/,/g,"")),withdrawable_threshold=parseFloat(""==$("#view_68 .field_89 .kn-detail-body").text().replace(/,/g,"")?0:$("#view_68 .field_89 .kn-detail-body").text().replace(/,/g,"")),max_per_request=parseFloat(""==$("#view_51 .kn-detail.field_105 .kn-detail-body span span").text().replace(/,/g,"")?0:$("#view_51 .kn-detail.field_105 .kn-detail-body span span").text().replace(/,/g,"")),days_to_request=parseInt(""==$("#view_51 .kn-detail.field_149 .kn-detail-body span span").text().replace(/,/g,"")?0:$("#view_51 .kn-detail.field_149 .kn-detail-body span span").text().replace(/,/g,"")),current_date=new Date,mtd=current_date.getDate()-1,tot=new Date(current_date.getFullYear(),current_date.getMonth()+1,0).getDate(),balance=base_salary*mtd/tot,available_amount=balance-requested_amount,check=requests_check(cutoff_day,payday,max_number_requests,max_per_request,days_to_request,next_payday),html='<section id="custom-view-scene1"><div class="payday-wrapper"><div><div class="payday-label">Next Payday</div><div class="payday-value">'+payday+'</div><span class="cutoff-message"><i>Cut-off at '+cutoff_day+'</i></span></div><img src="https://root.ewa-services.com/ewa/images/ico-calendar.svg"/></div><div class="max-withdrawable"><div class="max-withdrawable-label">Maximum Withdrawable Amount</div><div class="max-amount-button"><span>'+(!0===check.status?(Math.round(100*max_per_request)/100).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):0)+"</span><a"+(!0===check.status?' href="'+window.location.pathname+'#request"':' style="pointer-events:none;" class="disabled"')+">Withdraw</a></div>"+(!0===check.status?"":"<p class='error-message'>"+check.error+"</p>")+"</div></section>";$(html).insertBefore($("#kn-scene_1"))